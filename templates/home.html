{% extends "base.html" %}
{% block content %}

<!-- ========== Slider ========== -->
<section class="slider" id="homeSlider" aria-label="Featured items">
  <div class="slides">
     <!-- Slide 1 -->
    <figure class="slide" data-kind="image">
      <img src="{{ url_for('static', filename='img/Hot Latte.jpg') }}" alt="Hot Latte" loading="lazy" decoding="async">
      <figcaption>
        <h2>Hot Latte</h2>
        <a class="btn" href="{{ url_for('products', category='Coffee') }}">Order now</a>
      </figcaption>
    </figure>

    <!-- Slide 2 -->
    <figure class="slide" data-kind="image">
      <img src="{{ url_for('static', filename='img/Hot Cappuccino .jpg') }}" alt="Hot Cappuccino" loading="lazy" decoding="async">
      <figcaption>
        <h2>Hot Cappuccino</h2>
        <a class="btn" href="{{ url_for('products', category='Coffee') }}">Order now</a>
      </figcaption>
    </figure>

    <!-- Slide 3 -->
    <figure class="slide" data-kind="image">
      <img src="{{ url_for('static', filename='img/Storbery.jpg') }}" alt="Blueberry" loading="lazy" decoding="async">
      <figcaption>
        <h2>Blueberry</h2>
        <a class="btn" href="{{ url_for('products', category='Drink') }}">Order now</a>
      </figcaption>
    </figure>

    <!-- Slide 4 -->
    <figure class="slide" data-kind="image">
      <img src="{{ url_for('static', filename='img/Avocado.jpg') }}" alt="Avocado" loading="lazy" decoding="async">
      <figcaption>
        <h2>Avocado</h2>
        <a class="btn" href="{{ url_for('products', category='Drink') }}">Order now</a>
      </figcaption>
    </figure>
  </div>

  <button class="slider-btn prev" aria-label="Previous slide">‹</button>
  <button class="slider-btn next" aria-label="Next slide">›</button>
  <div class="slider-dots" aria-label="Slide navigation"></div>
{#  <a href="{{ url_for('products') }}" class="continue-order">Continue to Order</a>#}
</section>
<script>
(() => {
  function Slider(root, { interval = 200 } = {}) {
    const wrap = root.querySelector('.slides');
    const slides = Array.from(root.querySelectorAll('.slide'));
    const prev = root.querySelector('.prev');
    const next = root.querySelector('.next');
    const dotsWrap = root.querySelector('.slider-dots');

    let i = 0, t = null, dragging = false, startX = 0, curX = 0;

    function set(n) {
      i = (n + slides.length) % slides.length;
      wrap.style.transform = `translateX(-${i * 100}%)`;
      dotsWrap.querySelectorAll('button').forEach((b, idx) => b.classList.toggle('active', idx === i));
    }
    function start(){ stop(); t = setInterval(() => set(i + 1), interval); }
    function stop(){ if (t) { clearInterval(t); t = null; } }

    // dots
    slides.forEach((_, idx) => {
      const b = document.createElement('button');
      b.setAttribute('aria-label', `Go to slide ${idx + 1}`);
      if (idx === 0) b.classList.add('active');
      b.addEventListener('click', () => { set(idx); start(); });
      dotsWrap.appendChild(b);
    });

    prev.addEventListener('click', () => { set(i - 1); start(); });
    next.addEventListener('click', () => { set(i + 1); start(); });

    root.addEventListener('mouseenter', stop);
    root.addEventListener('mouseleave', start);

    // swipe
    wrap.addEventListener('pointerdown', (e) => {
      dragging = true; startX = e.clientX; curX = startX; stop();
      wrap.style.transition = 'none';
    });
    window.addEventListener('pointermove', (e) => {
      if (!dragging) return;
      curX = e.clientX;
      const dx = curX - startX;
      wrap.style.transform = `translateX(calc(-${i * 100}% + ${dx}px))`;
    });
    window.addEventListener('pointerup', () => {
      if (!dragging) return;
      const dx = curX - startX;
      wrap.style.transition = 'transform .5s ease';
      if (Math.abs(dx) > 50) set(i + (dx < 0 ? 1 : -1));
      else set(i);
      dragging = false; start();
    });

    set(0); start();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const s = document.getElementById('homeSlider');
    if (s) Slider(s, { interval: 2000 });
  });
})();
</script>

<!-- ========== New Video Section BELOW Slider ========== -->
<section class="intro" aria-label="About Kimhut Café">
    <div>
    <h2>Welcome to Kimhut Café</h2>
    <p>Experience the perfect blend of rich aroma and cozy atmosphere. Enjoy quick checkout with <b>KHQR</b> — pay easily in <b>USD</b> or <b>KHR</b>.</p>
    <p>Browse our menu and order online. Fresh coffee, comfort bites, fast pickup.</p>
    <p><a href="{{ url_for('products') }}" class="continue-order">Shop the Menu</a></p>
  </div>

  <!-- Video (place your files in static/media/) -->
  <video autoplay muted loop playsinline preload="metadata"
         poster="{{ url_for('static', filename='media/hero.jpg') }}">
    <source src="{{ url_for('static', filename='media/hero.webm') }}" type="video/webm">
    <source src="{{ url_for('static', filename='media/Demo.mp4') }}" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</section>

{% endblock %}
